name: Standard_Windows
Version: 1
formatVersion: 1
inputs:
  hostname:
    type: string
    title: VM Host name
  DC:
    type: string
    title: Datacenter
    default: DC-CTR-SQL-METRO
    enum:
      - DC-CTR-SQL-METRO
      - DC-CTR-SQL-ECO
      - DC-CTR-SQL-TDC
      - DC-VCF-QA-ECO
      - DC-VCF-QA-TDC
      - DC-VCF-QA-METRO
      - DC-AVS-POC
  Location:
    type: string
    title: Located in
    default: On-Prem
    enum:
      - On-Prem
      - AVS
      - Azure
  OSVserion:
    type: string
    title: OS Version
    default: '2022'
    enum:
      - '2019'
      - '2022'
  Domain:
    type: string
    title: Domain
    default: CORP.YW.KELDA
    minLength: 1
    enum:
      - CORP.YW.KELDA
      - YW.KELDA
  Env:
    type: string
    title: Enviroment
    default: QA
    enum:
      - PRD
      - QA
      - DEV
      - ST
  VRAENV:
    type: string
    default: QA
    enum:
      - PROD
      - QA
  ServiceLevel:
    type: string
    title: Service Level
    description: |-
      What level of service is this server?
      This will the necessary alerts and standby information required.
    default: Bronze
    enum:
      - Gold
      - Silver
      - Bronze
  count:
    type: integer
    title: No of VM's
    description: How many vm's do you require?
    default: 1
    minimum: 1
    maximum: 4
    readOnly: true
  MaintenanceWindowOptionSelect:
    type: string
    title: Maintenance Window Options
    description: Please select a day for the maintenance window for this server. The window starts from 11pm to 5PM.
    default: Monday
resources:
  Cloud_SaltStack_1:
    type: Cloud.SaltStack
    properties:
      hosts:
        - ${resource["Cloud_Machine_1"][*].id}
      masterId: saltstack_enterprise_installer
      minionId: ${resource["Cloud_Machine_1"][*].name}
      stateFiles:
        - /windows/DefaultSetup.sls
      saltEnvironment: base
      variables:
        LocalGroups: ${propgroup.const_prop_group.memory}
  Cloud_Machine_1:
    type: Cloud.Machine
    properties:
      remoteAccess:
        authentication: usernamePassword
        username: administrator
        password: VMware1!
      image: img01
      flavor: flavour1
      name: ${input.hostname}
      machineNameCustomProperty: ${input.hostname}
      adPatchGroupCustomProperty: ${input.MaintenanceWindowOptionSelect}
      domainName: ${input.Domain}
      resourceName: ${(input.hostname) + (input.Env)}
      hardwareVersion: vmx-17
      osType: WINDOWS
      constraints:
        - tag: account:cmbu-tango-e2e-vc02.eng.vmware.com / CMBU_TANGO_E2E_VC02_DC01-1
      networks:
        - network: ${resource.Cloud_Network_1.id}
      count: ${input.count}
      attachedDisks: []
  Cloud_Network_1:
    type: Cloud.Network
    properties:
      networkType: existing
      constraints:
        - tag: account:cmbu-tango-e2e-vc02.eng.vmware.com / CMBU_TANGO_E2E_VC02_DC01-1
